---
title: "Tarea1_Ricardo_Garbanzo"
author: "Ricardo Garbanzo"
date: "3/7/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#### 1. El archivo bosques energia.csv el cual contiene el resultado de dos estudios, uno en el que se mide la supercie boscosa en proporcion al terreno total de cada pais y el otro corresponde al consumo de energia renovable en proporcion al consumo de energia total. Estos estudios se hicieron en varios paises y en varios anos distintos. Con estos datos realize lo siguiente: 

### a) (10 pts) Convierta los datos a datos tidy.


```{r Ejercicio 1-A}
library(tidyr)
datos <- read.csv("bosques_energia.csv", header = T, sep = ",")
#datos <- datos[, colSums(is.na(datos)) != nrow(datos)]

years <- colnames(datos)[4:63]

wider <- pivot_wider(
  datos,
  names_from = Indicador,
  values_from = years 
)


```


### b) (6 pts) Elimine las variables innecesarias y explique el motivo.
```{r Ejercicio 1-B}
wider <- wider[, colSums(is.na(wider)) != nrow(wider)]
```
Al eliminar las columnas que solamente tienen valores NA nos aseguramos en remover solamente los años que no tienen registros




### c) (24 pts) Con la ayuda del paquete dplyr, realice lo siguiente:

#### - Con un grafico muestre la evolucion del consumo de energia renovable para los paises Canada, Paraguay, Peru y China. Debe mostrar tanto el grafico como la tabla de datos con la que se realizo el grafico.



```{r Grafico A}

library(tidyr)
library(dplyr)
library(ggplot2)
library(scales)
longer <- pivot_longer(
  datos, 
  cols = -c(Pais,Codigo.Pais,Indicador),
  names_to = "Year",
  values_to = "Porcentaje",
  values_drop_na = T
)

consumo <- filter(
  longer,
  longer$Indicador == "Consumo de energía renovable (% del consumo total de energía final)"
)


grafico_A <- consumo %>% filter(Pais %in% c("Canada","Paraguay", "Peru", "China"))

grafico_A$Year <- gsub("[a-zA-Z ]", "", grafico_A$Year)
grafico_A$Year <- as.factor(grafico_A$Year)
grafico_A



ggplot(grafico_A, mapping = aes(x=Porcentaje, y=Year, color = Pais))+
  geom_point()+
  labs(title = "Consumo de energía renovable")

```


#### - Con un grafico muestre los 10 paises con mayor superfcie bosocosa promedio para los anos analizados. Debe mostrar tanto el grafico como la tabla de datos con la que se realizo el grafico.
```{r}
library(tidyr)
library(dplyr)
library(ggplot2)
library(scales)
library(forcats)

longer <- pivot_longer(
  datos, 
  cols = -c(Pais,Codigo.Pais,Indicador),
  names_to = "Year",
  values_to = "Porcentaje",
  values_drop_na = T
)


superficie <- filter(
  longer,
  longer$Indicador == "Consumo de energía renovable (% del consumo total de energía final)"
)

superficie$Year <- gsub("[a-zA-Z ]", "", superficie$Year)
superficie$Year <- as.factor(superficie$Year)
str(superficie)

tabla_b <- pivot_wider(
  superficie, 
  id_cols = Pais, # No toma en cuenta la variable pais
  names_from = Year, 
  values_from = Porcentaje
)

grafico_B <- tabla_b %>% mutate(mean_all = rowMeans(tabla_b[-1]))

grafico_B_top_10 <- grafico_B %>% 
  filter(rank(desc(mean_all))<=10)

grafico_B_top_10

ggplot(data = grafico_B_top_10,
       mapping = aes(x = fct_reorder(Pais,mean_all),
                     y = mean_all)) +
  geom_col(fill = "#07689f") +
  scale_y_continuous() +
  theme_linedraw() +
  coord_flip()+
  labs(title = "Paises con mayor superficie boscosa",
       x = "Top 10 Paises",
       y = "Promedio de porcentaje")
  
```





#### Ejercicio 2. El archivo DatosEducacion.csv contiene informacion de las escueles primarias de varios paises durante los años 2013 a 2019. Las variables estan por filas, los valores de dichas variables estan en forma columna por año. Nota: No olvide revisar el archivo con un bloc de notas. Cargue la tabla de datos y luego realice lo siguiente:
```{r Carga de datos}
datos <- read.csv("DatosEducacion_V2.csv", header = T, sep = ",")
```


### a) (5 pts) Convierta el dataset a uno tidy. Elimine las variables innecesarias y los valores con NA.
```{r}
library(tidyr)

datos <- read.csv("DatosEducacion_V2.csv", header = T, sep = ",")

wider<- pivot_wider(
  datos,
  names_from = fecha, 
  values_from = valor,
  values_fill = list(valor = 0)
)
```


### b) (5 pts) Agrupe el dataset por pais y promedie los resultados, no incluya la variable fecha. Ademas, cambie los nombres de las variables a unos mas `cortos'.

```{r Ejercicio 2-B}
library(tidyr)
library(dplyr)

suma <- wider %>% mutate(mean_all = rowMeans(wider[-c(1,2,3)]))
suma <- suma[-c(2,4:10)] 
#sumaPais <- suma %>% group_by(indicador)

suma_P <- pivot_wider(
  suma,
  names_from = indicador, 
  values_from = mean_all
)

#str(suma_P)


suma_P <- rename(
  suma_P, 
  "Repitentes" = "Cantidad de Estudiantes que repitieron", 
  "Duracion en primaria" = "Duracion de la educacion primaria", 
  "Alfabetizacion mayores a 15" = "Porcentaje de alfabetizacion de adultos para la poblacion mayor de 15 aÃ±os",
  "% PIB en educacion primaria" = "Gasto publico en educacion primaria como porcentaje del PIB",
  "Gasto educacion en millones USD" = "Gasto publico bruto en educacion primaria en millones de dolares",
  "% matricula" = "Porcentaje de matricula",
  "% no escolarizados" = "Porcentaje de niÃ±os no escolarizados",
  "% desercion" = "Porcentaje de desercion"
)
suma_P

```


### c) (10 pts) Ejecute una Agrupacion Jerarquica con 3 clusters y muestre el dendrograma formado.

### d) (10 pts) Calcule los centros de cada cluster y de una interpretacion usando el graco de tipo radar.

### e) (24 pts) Construya una variable con el porcentaje de estudiantes que repiteron el año y otra con el gasto publico bruto si se repartiera en partes iguales a cada estudiante. Luego elimine las variables que se utilizaron para crear las 2 variables anteriores. Por ultimo, repita los 2 ejercicios anteriores con estos nuevos datos.

### f) (6 pts) Con base a los resultados obtenidos, responda a las siguientes preguntas:

#### - De los 2 resultados obtenidos anteriormente, Cual le hace mas sentido, segun los paises agrupados y sus caractersticas?

#### - A que se debe que sean tan diferentes los 2 resultados obtenidos?